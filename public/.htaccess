# Avoid issues with paths that look like file names
Options -MultiViews -Indexes

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Ensure index.html is served for the root
  RewriteRule ^index\.html$ - [L]
  
  # Don't rewrite files, directories, or symbols
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} !-l
  
  # Rewrite everything else to index.html
  # Use absolute path for routing to handle nested routes properly
  RewriteRule ^(.*)$ /index.html [L]
</IfModule>

# Fallback for 404s
ErrorDocument 404 /index.html

# Cache Control Headers
<IfModule mod_headers.c>
  # No cache for HTML files - always check for updates
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>
  
  # Long cache for hashed assets (JS, CSS with hash in filename)
  <FilesMatch "\.(js|css|woff|woff2|ttf|svg|jpg|jpeg|png|gif|ico|webp)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
</IfModule>

# Basic security to protect .htaccess
<Files .htaccess>
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order Allow,Deny
        Deny from all
    </IfModule>
</Files>
